<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="lj.mapper.survey.SurveyQuestionnaireMapper">

  <select id="findAll" resultType="SurveyQuestionnaire">
    select * from SurveyQuestionnaire
  </select>
  
  <select id="findAllByRequestObj" parameterType="SurveyQuestionnaire" resultType="SurveyQuestionnaire">
    select SurveyQuestionnaire.*
    from SurveyQuestionnaire
    where 1=1
    <if test="surveyQuestionId > 0">
      and surveyQuestionId = #{surveyQuestionId}
    </if>
    <if test="clientId > 0">
      and clientId = #{clientId}
    </if>
  </select>
 
  <select id="findAllPaged" parameterType="SurveyQuestionnaire" resultType="SurveyQuestionnaire">
    select  SurveyQuestionnaire.*,
            ClientInfo.clientName as clientName,
            ClientInfo.sourceMemo as sourceMemo,
            SurveyInfo.surveyTitle,SurveyInfo.surveyType,SurveyInfo.surveyTime,SurveyInfo.surveyMethod,
            QuestionInfo.questionTitle,QuestionInfo.questionType,
            UserInfo.userName as opUserName
    from SurveyQuestionnaire
    left join ClientInfo     on ClientInfo.clientId=SurveyQuestionnaire.clientId
    left join SurveyQuestion on SurveyQuestion.surveyQuestionId=SurveyQuestionnaire.surveyQuestionId
    left join SurveyInfo     on SurveyInfo.surveyId=SurveyQuestion.surveyId
    left join QuestionInfo   on QuestionInfo.questionId=SurveyQuestion.questionId
    left join UserInfo       on UserInfo.userId=SurveyQuestionnaire.opUserId
    where 1=1
    <if test="questionTitle!=null and questionTitle!='' ">
      and  QuestionInfo.questionTitle like  '%${questionTitle}%'
    </if>
    <if test="clientName!=null and clientName!='' ">
      and  ClientInfo.clientName like  '%${clientName}%'
    </if>
    <if test="sourceMemo!=null and sourceMemo!='' ">
      and  ClientInfo.sourceMemo like  '%${sourceMemo}%'
    </if>
    <if test="surveyTitle!=null and surveyTitle!='' ">
      and  SurveyInfo.surveyTitle like  '%${surveyTitle}%'
    </if>
    <if test="questionTitle!=null and questionTitle!='' ">
      and  QuestionInfo.questionTitle like  '%${questionTitle}%'
    </if>
    <if test="opUserName!=null and opUserName!='' ">
      and  UserInfo.userName like  '%${opUserName}%'
    </if>
    <if test="answerContent!=null and answerContent!='' ">
      and SurveyQuestionnaire.answerContent like  '%${answerContent}%'
    </if>
    <if test=" answerTimeBegin!=null">
      and SurveyQuestionnaire.answerTime>#{answerTimeBegin}
    </if>
    <if test=" answerTimeEnd!=null">
      and #{answerTimeEnd}>SurveyQuestionnaire.answerTime
    </if>
    order by ${sortField} ${sortType}
  </select>
  
  <select id="findById" parameterType="Long" resultType="SurveyQuestionnaire">
    select * from SurveyQuestionnaire where  surveyQuestionnaireId=#{id}
  </select>
  
  <select id="findAllByField" parameterType="Map" resultType="SurveyQuestionnaire">
    select * from SurveyQuestionnaire where ${fieldName}=#{fieldValue}
  </select>
 
  <insert id="insert" parameterType="SurveyQuestionnaire" flushCache="true" useGeneratedKeys="true" keyProperty="surveyQuestionnaireId" >
      insert into SurveyQuestionnaire( clientId, surveyQuestionId, questionnaireState, answerTime, answerContent, answerFileName, opTime, opUserId)
      values(#{clientId,jdbcType=NUMERIC},#{surveyQuestionId,jdbcType=NUMERIC},#{questionnaireState,jdbcType=VARCHAR},#{answerTime,jdbcType=TIMESTAMP},#{answerContent,jdbcType=VARCHAR},#{answerFileName,jdbcType=VARCHAR},#{opTime,jdbcType=TIMESTAMP},#{opUserId,jdbcType=NUMERIC})
  </insert>
  
   <update id="update" parameterType="SurveyQuestionnaire" >
     update SurveyQuestionnaire 
     set  clientId=#{clientId,jdbcType=NUMERIC},  surveyQuestionId=#{surveyQuestionId,jdbcType=NUMERIC},  questionnaireState=#{questionnaireState,jdbcType=VARCHAR},  answerTime=#{answerTime,jdbcType=TIMESTAMP},  answerContent=#{answerContent,jdbcType=VARCHAR}, answerFileName=#{answerFileName,jdbcType=VARCHAR}, opTime=#{opTime,jdbcType=TIMESTAMP},  opUserId=#{opUserId,jdbcType=NUMERIC}
     where surveyQuestionnaireId=#{surveyQuestionnaireId}
  </update>
  
  <delete id="deleteById" parameterType="long">
      delete from SurveyQuestionnaire where surveyQuestionnaireId=#{id}
  </delete>
  
</mapper>